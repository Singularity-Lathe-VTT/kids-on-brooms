<section class="grid grid-3col">
  
  <fieldset class="resource grid-span-3 flexcol">
  <div class="resource flexrow">
    <label for="system.age" class="resource-label">Age</label>
    <input type="text" name="system.age" value="{{system.age}}" data-dtype="String"/>
  </div>
  <div class="resource grid-span-2 flexrow">
    <label for="system.pronouns" class="resource-label">Pronouns</label>
    <input type="text" name="system.pronouns" value="{{system.pronouns}}" data-dtype="String"/>
  </div>
  <div class="resource grid-span-3 flexrow">
    <label for="system.fear" class="resource-label">Fear</label>
    <input type="text" name="system.fear" value="{{system.fear}}" data-dtype="String"/>
  </div>
  <div class="resource grid-span-3 flexrow" >
    <label for="system.motivation" class="resource-label">Motivation</label>
    <input type="text" name="system.motivation" value="{{system.motivation}}" data-dtype="String"/>
  </div>
  <div class="resource grid-span-3 flexrow" >
    <label for="system.description" class="resource-label">Description</label>
    <input type="text" name="system.description" value="{{system.description}}" data-dtype="String"/>
  </div>
  <div class="resource grid-span-3 flexrow">
    <label for="system.grade" class="resource-label">Grade</label>
    <input type="text" name="system.grade" value="{{system.grade}}" data-dtype="String"/>
  </div>
</fieldset>
  <fieldset class="resource grid-span-3 flexcol">
    <legend>Your Broom</legend>
  
    <!-- Broom Name Input with Dropdown -->
    <div class="resource flexrow">
      <label for="broom-name" class="resource-label">Name</label>
      <input list="broomOptions" id="broom-name" name="system.broom.name" 
             value="{{system.broom.name}}" data-dtype="String" placeholder="Select or Enter Broom Name"
             oninput="updateBroomDetails()" onblur="updateBroomDetails()">
      <datalist id="broomOptions">
        <option value="The Blocker's Broom" data-look="Defensive" data-mechanical="Gain the Guardian Strength"></option>
        <option value="Bolting 4000" data-look="Fast" data-mechanical="+1 to Flight checks"></option>
        <option value="The Bruiser" data-look="Intense" data-mechanical="+1 to Fight checks"></option>
        <option value="Cunning Captain’s Cruiser" data-look="Natural Leader" data-mechanical="Treat Snap Decisions as Planned Actions unless facing fear"></option>
        <option value="Daredevil’s Duster" data-look="Flashy" data-mechanical="+3 to Charm checks when performing a stunt"></option>
        <option value="The Daring Dodger 3000" data-look="Ambitious" data-mechanical="Each Adversity Token adds +2 to your roll instead of +1"></option>
        <option value="Heartwood’s Helper" data-look="Outgoing" data-mechanical="Each successful check grants an ally one Adversity Token"></option>
        <option value="Mapmaker’s Friend" data-look="Level-Headed" data-mechanical="Cannot get lost if you know the area"></option>
        <option value="The Mastermind’s Sweeper" data-look="Confident" data-mechanical="+1 to Brains checks"></option>
        <option value="The Strong Sweep 2500" data-look="Strong" data-mechanical="+1 to Brawn checks"></option>
        <option value="The Suave Sweeper" data-look="Trustworthy" data-mechanical="+1 to Charm checks"></option>
        <option value="The Tough Break" data-look="Tough" data-mechanical="+1 to Grit checks"></option>
        <option value="Valiance 2400" data-look="Brave" data-mechanical="May ignore your fears"></option>
        <option value="Weasel’s Whisk" data-look="Sneaky" data-mechanical="Gain the Unassuming Strength"></option>
      </datalist>
    </div>
  
    <!-- Broom Look -->
    <div class="resource flexrow">
      <label for="broom-look" class="resource-label">Look</label>
      <input type="text" id="broom-look" name="system.broom.look" 
             value="{{system.broom.look}}" data-dtype="String"/>
    </div>
  
    <!-- Mechanical Benefit as Textarea -->
    <div class="resource flexrow">
      <label for="broom-mechanical" class="resource-label">Mechanical Benefit</label>
      <textarea id="broom-mechanical" name="system.broom.mechanicalbenefit" 
                data-dtype="String" rows="3" style="resize:none;"></textarea>
    </div>
  
  </fieldset>
  
  <script>
  function updateBroomDetails() {
    // Use a short delay to allow browser to properly handle the datalist input
    setTimeout(function() {
      const broomNameInput = document.getElementById("broom-name").value.trim();
      const broomOptions = document.querySelectorAll("#broomOptions option");

      let selectedLook = "";
      let selectedMechanical = "";

      // Loop through the datalist options to find a matching broom name
      broomOptions.forEach(option => {
        if (option.value.toLowerCase() === broomNameInput.toLowerCase()) {
          selectedLook = option.getAttribute("data-look");
          selectedMechanical = option.getAttribute("data-mechanical");
        }
      });

      // Update the look and mechanical benefit fields if a predefined broom is selected
      document.getElementById("broom-look").value = selectedLook || "";
      document.getElementById("broom-mechanical").value = selectedMechanical || "";
    }, 100); // Delay of 100 milliseconds
  }
</script>
    <fieldset class="resource grid-span-3 flexcol">
      <legend>Wand Selection</legend>
  
        <!-- Wood Selection -->
        <div class="resource-flexrow">
        <label for="system.wand.wood" class="resource-label">Wood Type</label>
        <input list="WoodOptions" id="wandWoodChoice" class="right-align-input" name="system.wand.wood" placeholder="Select Wood type">
        <datalist id="WoodOptions">
          <option value="">Select Wood</option>
            <option value="Wisteria" {{#if (eq system.wand.wood "Wisteria")}}selected{{/if}}>Wisteria (Brains)</option>
            <option value="Hawthorn" {{#if (eq system.wand.wood "Hawthorn")}}selected{{/if}}>Hawthorn (Brains)</option>
            <option value="Pine" {{#if (eq system.wand.wood "Pine")}}selected{{/if}}>Pine (Brawn)</option>
            <option value="Oak" {{#if (eq system.wand.wood "Oak")}}selected{{/if}}>Oak (Brawn)</option>
            <option value="Crabapple" {{#if (eq system.wand.wood "Crabapple")}}selected{{/if}}>Crabapple (Fight)</option>
            <option value="Dogwood" {{#if (eq system.wand.wood "Dogwood")}}selected{{/if}}>Dogwood (Fight)</option>
            <option value="Birch" {{#if (eq system.wand.wood "Birch")}}selected{{/if}}>Birch (Flight)</option>
            <option value="Bamboo" {{#if (eq system.wand.wood "Bamboo")}}selected{{/if}}>Bamboo (Flight)</option>
            <option value="Ironwood" {{#if (eq system.wand.wood "Ironwood")}}selected{{/if}}>Ironwood (Grit)</option>
            <option value="Maple" {{#if (eq system.wand.wood "Maple")}}selected{{/if}}>Maple (Grit)</option>
            <option value="Lilac" {{#if (eq system.wand.wood "Lilac")}}selected{{/if}}>Lilac (Charm)</option>
            <option value="Cherry" {{#if (eq system.wand.wood "Cherry")}}selected{{/if}}>Cherry (Charm)</option>
        </datalist>
      </div>
  
        <!-- Core Selection -->
        <div class="resource-flexrow">
          <label for="system.wand.core"  class="resource-label">Core Type</label>
          <input list="CoreOptions" id="wandCoreChoice" class="right-align-input" name="system.wand.core" placeholder="Select Core type">
          <datalist id="CoreOptions">
            <option value="">Select Core</option>
            <option value="Parchment" {{#if (eq system.wand.core "Parchment")}}selected{{/if}}>Parchment (Brains)</option>
            <option value="Phoenix Feather" {{#if (eq system.wand.core "Phoenix Feather")}}selected{{/if}}>Phoenix Feather (Brains)</option>
            <option value="Owl Feather" {{#if (eq system.wand.core "Owl Feather")}}selected{{/if}}>Owl Feather (Brains)</option>
            <option value="Gorilla Fur" {{#if (eq system.wand.core "Gorilla Fur")}}selected{{/if}}>Gorilla Fur (Brawn)</option>
            <option value="Ogre’s Fingernail" {{#if (eq system.wand.core "Ogre’s Fingernail")}}selected{{/if}}>Ogre’s Fingernail (Brawn)</option>
            <option value="Hippo’s Tooth" {{#if (eq system.wand.core "Hippo’s Tooth")}}selected{{/if}}>Hippo’s Tooth (Brawn)</option>
            <option value="Dragon’s Heartstring" {{#if (eq system.wand.core "Dragon’s Heartstring")}}selected{{/if}}>Dragon’s Heartstring (Fight)</option>
            <option value="Wolf’s Tooth" {{#if (eq system.wand.core "Wolf’s Tooth")}}selected{{/if}}>Wolf’s Tooth (Fight)</option>
            <option value="Elk’s Antler" {{#if (eq system.wand.core "Elk’s Antler")}}selected{{/if}}>Elk’s Antler (Fight)</option>
            <option value="Hawk’s Feather" {{#if (eq system.wand.core "Hawk’s Feather")}}selected{{/if}}>Hawk’s Feather (Flight)</option>
            <option value="Bat’s Bone" {{#if (eq system.wand.core "Bat’s Bone")}}selected{{/if}}>Bat’s Bone (Flight)</option>
            <option value="Changeling’s Hair" {{#if (eq system.wand.core "Changeling’s Hair")}}selected{{/if}}>Changeling’s Hair (Charm)</option>
            <option value="Gold" {{#if (eq system.wand.core "Gold")}}selected{{/if}}>Gold (Charm)</option>
            <option value="Mirror" {{#if (eq system.wand.core "Mirror")}}selected{{/if}}>Mirror (Charm)</option>
            <option value="Steel" {{#if (eq system.wand.core "Steel")}}selected{{/if}}>Steel (Grit)</option>
            <option value="Diamond" {{#if (eq system.wand.core "Diamond")}}selected{{/if}}>Diamond (Grit)</option>
            <option value="Lion’s Mane" {{#if (eq system.wand.core "Lion’s Mane")}}selected{{/if}}>Lion’s Mane (Grit)</option>
          </datalist>
        </div>  
  </fieldset>
  <fieldset class="resource grid-span-3 flexcol">
    <legend>Animal Familiar</legend>
    <div class="resource grid-span-3 flexrow">
      <label for="system.animalfamiliar" class="resource-label">Animal Familiar</label>
      <input type="text" name="system.animalfamiliar" value="{{system.animalfamiliar}}" data-dtype="String"/>
    </div>
  </fieldset>
  
</section>